<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm BN: npc_ai Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm BN
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('namespacenpc__ai.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">npc_ai Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9faf14aeb5366ab3ab7efb40e267907d"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a9faf14aeb5366ab3ab7efb40e267907d">wielded_value</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, bool ideal)</td></tr>
<tr class="memdesc:a9faf14aeb5366ab3ab7efb40e267907d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evaluate wielded weapon.  <a href="namespacenpc__ai.html#a9faf14aeb5366ab3ab7efb40e267907d">More...</a><br /></td></tr>
<tr class="separator:a9faf14aeb5366ab3ab7efb40e267907d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fa541a904a63a5b95b20ce9000254d8"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a6fa541a904a63a5b95b20ce9000254d8">weapon_value</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;weap, int ammo)</td></tr>
<tr class="memdesc:a6fa541a904a63a5b95b20ce9000254d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evaluate item as weapon (melee or gun)  <a href="namespacenpc__ai.html#a6fa541a904a63a5b95b20ce9000254d8">More...</a><br /></td></tr>
<tr class="separator:a6fa541a904a63a5b95b20ce9000254d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a198ce7a4cff534bf1df12f584bff1197"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">gun_value</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;weap, int ammo)</td></tr>
<tr class="memdesc:a198ce7a4cff534bf1df12f584bff1197"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evaluates item as a gun.  <a href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">More...</a><br /></td></tr>
<tr class="separator:a198ce7a4cff534bf1df12f584bff1197"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15c5ded877137a648d04762228055b66"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a15c5ded877137a648d04762228055b66">melee_value</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;weap)</td></tr>
<tr class="memdesc:a15c5ded877137a648d04762228055b66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evaluate item as a melee weapon.  <a href="namespacenpc__ai.html#a15c5ded877137a648d04762228055b66">More...</a><br /></td></tr>
<tr class="separator:a15c5ded877137a648d04762228055b66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64daf871b45496787e445f932f4381d3"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a64daf871b45496787e445f932f4381d3">unarmed_value</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who)</td></tr>
<tr class="memdesc:a64daf871b45496787e445f932f4381d3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evaluate unarmed melee value.  <a href="namespacenpc__ai.html#a64daf871b45496787e445f932f4381d3">More...</a><br /></td></tr>
<tr class="separator:a64daf871b45496787e445f932f4381d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a198ce7a4cff534bf1df12f584bff1197" name="a198ce7a4cff534bf1df12f584bff1197"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a198ce7a4cff534bf1df12f584bff1197">&#9670;&nbsp;</a></span>gun_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_ai::gun_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>weap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ammo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evaluates item as a gun. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01970">1970</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span>{</div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span>    <span class="comment">// TODO: Mods</span></div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span>    <span class="comment">// TODO: Allow using a specified type of ammo rather than default or current</span></div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span>    <span class="keywordflow">if</span>( !weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a> ) {</div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span>        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>    }</div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span> </div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span>    <span class="keywordflow">if</span>( ammo &lt;= 0 ) {</div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span>        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span>    }</div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span> </div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>    <a class="code hl_class" href="classstring__id.html">itype_id</a> ammo_type;</div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span>    <span class="keywordflow">if</span>( !weap.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>().<a class="code hl_function" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ) {</div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span>        ammo_type = weap.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>();</div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( weap.<a class="code hl_function" href="classitem.html#ab22fc9a4e0f9c6f5569b93e00deccfac">magazine_current</a>() ) {</div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span>        ammo_type = weap.<a class="code hl_function" href="classitem.html#a5cc833f71e0454446fd0f877d24f6585">common_ammo_default</a>();</div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>        ammo_type = weap.<a class="code hl_function" href="classitem.html#ab07d96e30c441a84435972df842f4c77">ammo_default</a>();</div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span>    }</div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structitype.html">itype</a> *def_ammo_i = ammo_type.<a class="code hl_function" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ? nullptr : &amp;*ammo_type;</div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span> </div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span>    <a class="code hl_struct" href="structdamage__instance.html">damage_instance</a> gun_damage = weap.<a class="code hl_function" href="classitem.html#ada111938a57ec6c7b47fcca30ec9d36c">gun_damage</a>();</div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> ammo_cap = weap.<a class="code hl_function" href="classitem.html#a5d89f04a2a08245ec865db0865e8a6c1">ammo_capacity</a>();</div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span>    <span class="keywordtype">bool</span> empty = weap.<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>() == 0;</div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>    <a class="code hl_class" href="classitem.html">item</a> tmp = weap;</div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span>    tmp.<a class="code hl_function" href="classitem.html#a6a3f16444c412bce4b75a7d600d6a3fe">ammo_set</a>( ammo_type );</div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span>    <span class="keywordtype">int</span> total_dispersion = <a class="code hl_function" href="namespaceranged.html#a8b31304e61913a0072ad6df6e16bc932">ranged::get_weapon_dispersion</a>( who, tmp ).<a class="code hl_function" href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">max</a>() +</div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span>                           <a class="code hl_function" href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">ranged::effective_dispersion</a>( who, tmp.<a class="code hl_function" href="classitem.html#af0b7e5875297be57d675270f57ff775a">sight_dispersion</a>() );</div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span> </div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span>    <span class="keywordflow">if</span>( def_ammo_i != <span class="keyword">nullptr</span> &amp;&amp; def_ammo_i-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a> ) {</div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structislot__ammo.html">islot_ammo</a> &amp;def_ammo = *def_ammo_i-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>;</div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span>        gun_damage.<a class="code hl_function" href="structdamage__instance.html#ae17bfa13ed37fd55281fa769a152e941">add</a>( def_ammo.<a class="code hl_variable" href="structcommon__ranged__data.html#a94254f1acb94261bb47c4b7aaa3b0c89">damage</a> );</div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span>        total_dispersion += def_ammo.<a class="code hl_variable" href="structcommon__ranged__data.html#a497cd4533098e79f14f8a97fcec6ca1a">dispersion</a>;</div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span>    }</div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span> </div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span>    <span class="keywordtype">float</span> damage_factor = gun_damage.<a class="code hl_function" href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">total_damage</a>();</div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span>    <span class="keywordflow">if</span>( damage_factor &gt; 0 ) {</div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span>        <span class="comment">// TODO: Multiple damage types</span></div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span>        damage_factor += 0.5f * gun_damage.<a class="code hl_variable" href="structdamage__instance.html#a2cc3ee4ff8f77ab6cd74168b1999246a">damage_units</a>.front().res_pen;</div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span>    }</div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span> </div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span>    <span class="keywordtype">int</span> <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> = <a class="code hl_function" href="ranged_8cpp.html#a638db6e0db76944effa8b6913f708d34">time_to_attack</a>( who, weap, <a class="code hl_class" href="classitem__location.html">item_location</a>() );</div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span>    <span class="keywordflow">if</span>( empty &amp;&amp; ammo &gt;= 1 ) {</div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span>        <span class="keywordtype">int</span> reload_cost = weap.<a class="code hl_function" href="classitem.html#aad3353f629e527eb4b9f6c2f666f9e36">get_reload_time</a>() + who.<a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a> ) + who.<a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a> );</div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span>        <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> += reload_cost;</div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span>    }</div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span> </div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span>    <span class="comment">// Gives an approximation of DPS disregarding modes.</span></div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>    <span class="keywordtype">float</span> move_cost_factor = <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> / 100.0f;</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span> </div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span>    <span class="comment">// &quot;Medium range&quot; below means 9 tiles, &quot;short range&quot; means 4</span></div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span>    <span class="comment">// Those are guarantees (assuming maximum time spent aiming)</span></div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;std::pair&lt;float, float&gt;&gt; dispersion_thresholds = {</div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span>        {</div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span>            <span class="comment">// Headshots all the time</span></div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span>            { 0.0f, 5.0f },</div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span>            <span class="comment">// Critical at medium range</span></div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span>            { 100.0f, 4.5f },</div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span>            <span class="comment">// Critical at short range or good hit at medium</span></div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>            { 200.0f, 3.5f },</div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>            <span class="comment">// OK hits at medium</span></div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span>            { 300.0f, 3.0f },</div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span>            <span class="comment">// Point blank headshots</span></div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span>            { 450.0f, 2.5f },</div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span>            <span class="comment">// OK hits at short</span></div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span>            { 700.0f, 1.5f },</div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span>            <span class="comment">// Glances at medium, criticals at point blank</span></div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span>            { 1000.0f, 1.0f },</div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>            <span class="comment">// Nothing guaranteed, pure gamble</span></div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span>            { 2000.0f, 0.1f },</div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span>        }</div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span>    };</div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span> </div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span>    <span class="keywordtype">float</span> dispersion_factor = <a class="code hl_function" href="cata__utility_8cpp.html#ac49c7bae3c3ac926a5501ffb127c1e97">multi_lerp</a>( dispersion_thresholds, total_dispersion );</div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span> </div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span>    <span class="keywordtype">float</span> damage_and_accuracy = damage_factor * dispersion_factor;</div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span> </div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span>    <span class="comment">// TODO: Some better approximation of the ability to keep on shooting</span></div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;std::pair&lt;float, float&gt;&gt; capacity_thresholds = {</div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span>        {</div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span>            { 1.0f, 0.5f },</div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span>            { 5.0f, 1.0f },</div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span>            { 10.0f, 1.5f },</div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span>            { 20.0f, 2.0f },</div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>            { 50.0f, 3.0f },</div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span>        }</div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>    };</div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span> </div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span>    <span class="comment">// Ammo capacity. Reduced to ammo available if that&#39;s lower.</span></div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span>    <span class="keywordtype">float</span> capacity = ammo_cap &gt; 0 ? std::min( ammo_cap, ammo ) : ammo;</div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span> </div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span>    <span class="keywordtype">double</span> capacity_factor = <a class="code hl_function" href="cata__utility_8cpp.html#ac49c7bae3c3ac926a5501ffb127c1e97">multi_lerp</a>( capacity_thresholds, capacity );</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span> </div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>    <span class="keywordtype">double</span> <a class="code hl_function" href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">gun_value</a> = damage_and_accuracy * capacity_factor * move_cost_factor;</div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span> </div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span>    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s as gun: %.1f total, %.1f dispersion, %.1f damage, %.1f capacity, %.1f move&quot;</span>,</div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span>             weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>(), <a class="code hl_function" href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">gun_value</a>, dispersion_factor, damage_factor,</div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span>             capacity_factor, move_cost_factor );</div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span>    <span class="keywordflow">return</span> std::max( 0.0, <a class="code hl_function" href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">gun_value</a> );</div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span>}</div>
<div class="ttc" id="aactivity__item__handling_8cpp_html_a0572000ec0976f2d095ae0cd9d20e78b"><div class="ttname"><a href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a></div><div class="ttdeci">static int move_cost(const item &amp;it, const tripoint &amp;src, const tripoint &amp;dest)</div><div class="ttdef"><b>Definition:</b> <a href="activity__item__handling_8cpp_source.html#l00899">activity_item_handling.cpp:899</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a></div><div class="ttdeci">@ bp_hand_l</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00046">bodypart.h:46</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a></div><div class="ttdeci">@ bp_hand_r</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00047">bodypart.h:47</a></div></div>
<div class="ttc" id="acata__utility_8cpp_html_ac49c7bae3c3ac926a5501ffb127c1e97"><div class="ttname"><a href="cata__utility_8cpp.html#ac49c7bae3c3ac926a5501ffb127c1e97">multi_lerp</a></div><div class="ttdeci">float multi_lerp(const std::vector&lt; std::pair&lt; float, float &gt; &gt; &amp;points, float x)</div><div class="ttdoc">From points, finds p1 and p2 such that p1.first &lt; x &lt; p2.first Then linearly interpolates between p1....</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8cpp_source.html#l00157">cata_utility.cpp:157</a></div></div>
<div class="ttc" id="aclassCharacter_html_adc1fd84a88722a905e57fea8bfd5b6b0"><div class="ttname"><a href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">Character::encumb</a></div><div class="ttdeci">int encumb(body_part bp) const</div><div class="ttdoc">Returns ENC provided by armor, etc.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04010">character.cpp:4010</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_ac3dc7f13e78a217aeaba57740f3af17c"><div class="ttname"><a href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">dispersion_sources::max</a></div><div class="ttdeci">double max() const</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8cpp_source.html#l00020">dispersion.cpp:20</a></div></div>
<div class="ttc" id="aclassitem__location_html"><div class="ttname"><a href="classitem__location.html">item_location</a></div><div class="ttdoc">A lightweight handle to an item independent of it's location Unlike a raw pointer can be (de-)seriali...</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8h_source.html#l00022">item_location.h:23</a></div></div>
<div class="ttc" id="aclassitem_html"><div class="ttname"><a href="classitem.html">item</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00210">item.h:211</a></div></div>
<div class="ttc" id="aclassitem_html_a26c025fd4909bd31c8e91ed87905507b"><div class="ttname"><a href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">item::ammo_remaining</a></div><div class="ttdeci">int ammo_remaining() const</div><div class="ttdoc">Quantity of ammunition currently loaded in tool, gun or auxiliary gunmod.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07387">item.cpp:7387</a></div></div>
<div class="ttc" id="aclassitem_html_a5cc833f71e0454446fd0f877d24f6585"><div class="ttname"><a href="classitem.html#a5cc833f71e0454446fd0f877d24f6585">item::common_ammo_default</a></div><div class="ttdeci">itype_id common_ammo_default(bool conversion=true) const</div><div class="ttdoc">Get default ammo for the first ammotype common to an item and its current magazine or &quot;NULL&quot; if none ...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07617">item.cpp:7617</a></div></div>
<div class="ttc" id="aclassitem_html_a5d89f04a2a08245ec865db0865e8a6c1"><div class="ttname"><a href="classitem.html#a5d89f04a2a08245ec865db0865e8a6c1">item::ammo_capacity</a></div><div class="ttdeci">int ammo_capacity() const</div><div class="ttdoc">Maximum quantity of ammunition loadable for tool, gun or auxiliary gunmod.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07414">item.cpp:7414</a></div></div>
<div class="ttc" id="aclassitem_html_a624c3b7ec10ae766a9e75718af71e647"><div class="ttname"><a href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">item::ammo_current</a></div><div class="ttdeci">itype_id ammo_current() const</div><div class="ttdoc">Specific ammo type, returns &quot;null&quot; if item is neither ammo nor loaded with any.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07564">item.cpp:7564</a></div></div>
<div class="ttc" id="aclassitem_html_a6a3f16444c412bce4b75a7d600d6a3fe"><div class="ttname"><a href="classitem.html#a6a3f16444c412bce4b75a7d600d6a3fe">item::ammo_set</a></div><div class="ttdeci">item &amp; ammo_set(const itype_id &amp;ammo, int qty=-1)</div><div class="ttdoc">Filter setting the ammo for this instance Any existing ammo is removed.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00590">item.cpp:590</a></div></div>
<div class="ttc" id="aclassitem_html_aad3353f629e527eb4b9f6c2f666f9e36"><div class="ttname"><a href="classitem.html#aad3353f629e527eb4b9f6c2f666f9e36">item::get_reload_time</a></div><div class="ttdeci">int get_reload_time() const</div><div class="ttdoc">Returns the reload time of the gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06528">item.cpp:6528</a></div></div>
<div class="ttc" id="aclassitem_html_ab07d96e30c441a84435972df842f4c77"><div class="ttname"><a href="classitem.html#ab07d96e30c441a84435972df842f4c77">item::ammo_default</a></div><div class="ttdeci">itype_id ammo_default(bool conversion=true) const</div><div class="ttdoc">Get default ammo used by item or a null id if item does not have a default ammo type.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07601">item.cpp:7601</a></div></div>
<div class="ttc" id="aclassitem_html_ab22fc9a4e0f9c6f5569b93e00deccfac"><div class="ttname"><a href="classitem.html#ab22fc9a4e0f9c6f5569b93e00deccfac">item::magazine_current</a></div><div class="ttdeci">item * magazine_current()</div><div class="ttdoc">Currently loaded magazine (if any)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07727">item.cpp:7727</a></div></div>
<div class="ttc" id="aclassitem_html_ac1d2c4c33b8a499812f3437cb2fad742"><div class="ttname"><a href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">item::type</a></div><div class="ttdeci">const itype * type</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02162">item.h:2162</a></div></div>
<div class="ttc" id="aclassitem_html_ada111938a57ec6c7b47fcca30ec9d36c"><div class="ttname"><a href="classitem.html#ada111938a57ec6c7b47fcca30ec9d36c">item::gun_damage</a></div><div class="ttdeci">damage_instance gun_damage(bool with_ammo=true) const</div><div class="ttdoc">Summed ranged damage, armor piercing, and multipliers for both, of a gun, including values from mods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07280">item.cpp:7280</a></div></div>
<div class="ttc" id="aclassitem_html_af0b7e5875297be57d675270f57ff775a"><div class="ttname"><a href="classitem.html#af0b7e5875297be57d675270f57ff775a">item::sight_dispersion</a></div><div class="ttdeci">int sight_dispersion() const</div><div class="ttdoc">Get lowest dispersion of either integral or any attached sights.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07261">item.cpp:7261</a></div></div>
<div class="ttc" id="aclassstring__id_html"><div class="ttname"><a href="classstring__id.html">string_id&lt; itype &gt;</a></div></div>
<div class="ttc" id="aclassstring__id_html_a3ca78345025397b3d3ac22729ba1684b"><div class="ttname"><a href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">string_id::is_null</a></div><div class="ttdeci">bool is_null() const</div><div class="ttdoc">Returns whether this represents the id of the null-object (in which case it's the null-id).</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00317">string_id.h:317</a></div></div>
<div class="ttc" id="aclassstring__id_html_aa7dabc565f0c067e1a237ea224b18f93"><div class="ttname"><a href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">string_id::str</a></div><div class="ttdeci">const std::string &amp; str() const</div><div class="ttdoc">Returns the identifier as plain std::string.</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00255">string_id.h:255</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a></div><div class="ttdeci">@ m_debug</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00271">enums.h:271</a></div></div>
<div class="ttc" id="amessages_8cpp_html_a54489326fc37823819c5105addfa27f2"><div class="ttname"><a href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a></div><div class="ttdeci">void add_msg(std::string msg)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8cpp_source.html#l00910">messages.cpp:910</a></div></div>
<div class="ttc" id="anamespacenpc__ai_html_a198ce7a4cff534bf1df12f584bff1197"><div class="ttname"><a href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">npc_ai::gun_value</a></div><div class="ttdeci">double gun_value(const Character &amp;who, const item &amp;weap, int ammo)</div><div class="ttdoc">Evaluates item as a gun.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01970">ranged.cpp:1970</a></div></div>
<div class="ttc" id="anamespaceranged_html_a77dfe116a20cfa50c55a3c2073408e63"><div class="ttname"><a href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">ranged::effective_dispersion</a></div><div class="ttdeci">int effective_dispersion(const Character &amp;who, int dispersion)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03807">ranged.cpp:3807</a></div></div>
<div class="ttc" id="anamespaceranged_html_a8b31304e61913a0072ad6df6e16bc932"><div class="ttname"><a href="namespaceranged.html#a8b31304e61913a0072ad6df6e16bc932">ranged::get_weapon_dispersion</a></div><div class="ttdeci">dispersion_sources get_weapon_dispersion(const Character &amp;who, const item &amp;obj)</div><div class="ttdoc">Get weapon's dispersion value modified accoring to character stats.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01920">ranged.cpp:1920</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a638db6e0db76944effa8b6913f708d34"><div class="ttname"><a href="ranged_8cpp.html#a638db6e0db76944effa8b6913f708d34">time_to_attack</a></div><div class="ttdeci">int time_to_attack(const Character &amp;p, const item &amp;firing, const item_location loc)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01737">ranged.cpp:1737</a></div></div>
<div class="ttc" id="astructcommon__ranged__data_html_a497cd4533098e79f14f8a97fcec6ca1a"><div class="ttname"><a href="structcommon__ranged__data.html#a497cd4533098e79f14f8a97fcec6ca1a">common_ranged_data::dispersion</a></div><div class="ttdeci">int dispersion</div><div class="ttdoc">Dispersion &quot;bonus&quot; from gun.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00420">itype.h:420</a></div></div>
<div class="ttc" id="astructcommon__ranged__data_html_a94254f1acb94261bb47c4b7aaa3b0c89"><div class="ttname"><a href="structcommon__ranged__data.html#a94254f1acb94261bb47c4b7aaa3b0c89">common_ranged_data::damage</a></div><div class="ttdeci">damage_instance damage</div><div class="ttdoc">Damage, armor piercing and multipliers for each.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00412">itype.h:412</a></div></div>
<div class="ttc" id="astructdamage__instance_html"><div class="ttname"><a href="structdamage__instance.html">damage_instance</a></div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00051">damage.h:51</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a2cc3ee4ff8f77ab6cd74168b1999246a"><div class="ttname"><a href="structdamage__instance.html#a2cc3ee4ff8f77ab6cd74168b1999246a">damage_instance::damage_units</a></div><div class="ttdeci">std::vector&lt; damage_unit &gt; damage_units</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00052">damage.h:52</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a96f6f6d008ed8744ce549cefcfec3951"><div class="ttname"><a href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">damage_instance::total_damage</a></div><div class="ttdeci">float total_damage() const</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00075">damage.cpp:75</a></div></div>
<div class="ttc" id="astructdamage__instance_html_ae17bfa13ed37fd55281fa769a152e941"><div class="ttname"><a href="structdamage__instance.html#ae17bfa13ed37fd55281fa769a152e941">damage_instance::add</a></div><div class="ttdeci">void add(const damage_instance &amp;added_di)</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00093">damage.cpp:93</a></div></div>
<div class="ttc" id="astructislot__ammo_html"><div class="ttname"><a href="structislot__ammo.html">islot_ammo</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00672">itype.h:672</a></div></div>
<div class="ttc" id="astructitype_html"><div class="ttname"><a href="structitype.html">itype</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00836">itype.h:836</a></div></div>
<div class="ttc" id="astructitype_html_a623ec8243b1e599086fa3a23c3179370"><div class="ttname"><a href="structitype.html#a623ec8243b1e599086fa3a23c3179370">itype::gun</a></div><div class="ttdeci">cata::value_ptr&lt; islot_gun &gt; gun</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00859">itype.h:859</a></div></div>
<div class="ttc" id="astructitype_html_a7cb80d77696cefb42ac6e75756b47e60"><div class="ttname"><a href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">itype::ammo</a></div><div class="ttdeci">cata::value_ptr&lt; islot_ammo &gt; ammo</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00864">itype.h:864</a></div></div>
<div class="ttc" id="astructitype_html_abc2596bacfc718fba56ab8076bab5d6b"><div class="ttname"><a href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">itype::get_id</a></div><div class="ttdeci">const itype_id &amp; get_id() const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8cpp_source.html#l00088">itype.cpp:88</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="damage_8cpp_source.html#l00093">damage_instance::add()</a>, <a class="el" href="messages_8cpp_source.html#l00910">add_msg()</a>, <a class="el" href="itype_8h_source.html#l00864">itype::ammo</a>, <a class="el" href="item_8cpp_source.html#l07414">item::ammo_capacity()</a>, <a class="el" href="item_8cpp_source.html#l07564">item::ammo_current()</a>, <a class="el" href="item_8cpp_source.html#l07601">item::ammo_default()</a>, <a class="el" href="item_8cpp_source.html#l07387">item::ammo_remaining()</a>, <a class="el" href="item_8cpp_source.html#l00590">item::ammo_set()</a>, <a class="el" href="bodypart_8h_source.html#l00046">bp_hand_l</a>, <a class="el" href="bodypart_8h_source.html#l00047">bp_hand_r</a>, <a class="el" href="item_8cpp_source.html#l07617">item::common_ammo_default()</a>, <a class="el" href="itype_8h_source.html#l00412">common_ranged_data::damage</a>, <a class="el" href="damage_8h_source.html#l00052">damage_instance::damage_units</a>, <a class="el" href="itype_8h_source.html#l00420">common_ranged_data::dispersion</a>, <a class="el" href="ranged_8cpp_source.html#l03807">ranged::effective_dispersion()</a>, <a class="el" href="character_8cpp_source.html#l04010">Character::encumb()</a>, <a class="el" href="itype_8cpp_source.html#l00088">itype::get_id()</a>, <a class="el" href="item_8cpp_source.html#l06528">item::get_reload_time()</a>, <a class="el" href="ranged_8cpp_source.html#l01920">ranged::get_weapon_dispersion()</a>, <a class="el" href="itype_8h_source.html#l00859">itype::gun</a>, <a class="el" href="item_8cpp_source.html#l07280">item::gun_damage()</a>, <a class="el" href="ranged_8cpp_source.html#l01970">gun_value()</a>, <a class="el" href="string__id_8h_source.html#l00317">string_id&lt; T &gt;::is_null()</a>, <a class="el" href="enums_8h_source.html#l00271">m_debug</a>, <a class="el" href="item_8cpp_source.html#l07727">item::magazine_current()</a>, <a class="el" href="dispersion_8cpp_source.html#l00020">dispersion_sources::max()</a>, <a class="el" href="activity__item__handling_8cpp_source.html#l00899">move_cost()</a>, <a class="el" href="cata__utility_8cpp_source.html#l00157">multi_lerp()</a>, <a class="el" href="item_8cpp_source.html#l07261">item::sight_dispersion()</a>, <a class="el" href="string__id_8h_source.html#l00255">string_id&lt; T &gt;::str()</a>, <a class="el" href="ranged_8cpp_source.html#l01737">time_to_attack()</a>, <a class="el" href="damage_8cpp_source.html#l00075">damage_instance::total_damage()</a>, and <a class="el" href="item_8h_source.html#l02162">item::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l01970">gun_value()</a>, and <a class="el" href="melee_8cpp_source.html#l02318">weapon_value()</a>.</p>

</div>
</div>
<a id="a15c5ded877137a648d04762228055b66" name="a15c5ded877137a648d04762228055b66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15c5ded877137a648d04762228055b66">&#9670;&nbsp;</a></span>melee_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_ai::melee_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>weap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evaluate item as a melee weapon. </p>

<p class="definition">Definition at line <a class="el" href="melee_8cpp_source.html#l02337">2337</a> of file <a class="el" href="melee_8cpp_source.html">melee.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span>{</div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span>    <span class="comment">// start with average effective dps against a range of enemies</span></div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span>    <span class="keywordtype">double</span> my_value = weap.<a class="code hl_function" href="classitem.html#a96c8a18aef6da2f8d876178a3d21dfb0">average_dps</a>( *who.<a class="code hl_function" href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">as_player</a>() );</div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span> </div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span>    <span class="keywordtype">float</span> reach = weap.<a class="code hl_function" href="classitem.html#a04985a2b99688b687432463fb2f0a853">reach_range</a>( who );</div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span>    <span class="comment">// value reach weapons more</span></div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span>    <span class="keywordflow">if</span>( reach &gt; 1.0f ) {</div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span>        my_value *= 1.0f + 0.5f * ( std::sqrt( reach ) - 1.0f );</div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span>    }</div>
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"> 2347</span>    <span class="comment">// value polearms less to account for the trickiness of keeping the right range</span></div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span>    <span class="keywordflow">if</span>( weap.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;POLEARM&quot;</span> ) ) {</div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span>        my_value *= 0.8;</div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span>    }</div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span> </div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span>    <span class="comment">// value style weapons more</span></div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span>    <span class="keywordflow">if</span>( !who.<a class="code hl_variable" href="classCharacter.html#a313797e99525bfd2a5ead68b7672f168">martial_arts_data</a>-&gt;enumerate_known_styles( weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>() ).empty() ) {</div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span>        my_value *= 1.5;</div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span>    }</div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span> </div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span>    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s as melee: %.1f&quot;</span>, weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>(), my_value );</div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span> </div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span>    <span class="keywordflow">return</span> std::max( 0.0, my_value );</div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span>}</div>
<div class="ttc" id="aclassCharacter_html_a313797e99525bfd2a5ead68b7672f168"><div class="ttname"><a href="classCharacter.html#a313797e99525bfd2a5ead68b7672f168">Character::martial_arts_data</a></div><div class="ttdeci">pimpl&lt; character_martial_arts &gt; martial_arts_data</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01581">character.h:1581</a></div></div>
<div class="ttc" id="aclassCreature_html_acb1d0a1210d3dd4c86350f3ad4c58649"><div class="ttname"><a href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">Creature::as_player</a></div><div class="ttdeci">virtual player * as_player()</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00122">creature.h:122</a></div></div>
<div class="ttc" id="aclassitem_html_a04985a2b99688b687432463fb2f0a853"><div class="ttname"><a href="classitem.html#a04985a2b99688b687432463fb2f0a853">item::reach_range</a></div><div class="ttdeci">int reach_range(const Character &amp;guy) const</div><div class="ttdoc">Max range of melee attack this weapon can be used for.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05265">item.cpp:5265</a></div></div>
<div class="ttc" id="aclassitem_html_a96c8a18aef6da2f8d876178a3d21dfb0"><div class="ttname"><a href="classitem.html#a96c8a18aef6da2f8d876178a3d21dfb0">item::average_dps</a></div><div class="ttdeci">double average_dps(const player &amp;guy) const</div><div class="ttdoc">return the average dps of the weapon against evaluation monsters</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01448">item.cpp:1448</a></div></div>
<div class="ttc" id="aclassitem_html_aaa5aeb6f838927babb10ede535cf2a73"><div class="ttname"><a href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">item::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05303">item.cpp:5303</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="messages_8cpp_source.html#l00910">add_msg()</a>, <a class="el" href="creature_8h_source.html#l00122">Creature::as_player()</a>, <a class="el" href="item_8cpp_source.html#l01448">item::average_dps()</a>, <a class="el" href="itype_8cpp_source.html#l00088">itype::get_id()</a>, <a class="el" href="item_8cpp_source.html#l05303">item::has_flag()</a>, <a class="el" href="enums_8h_source.html#l00271">m_debug</a>, <a class="el" href="character_8h_source.html#l01581">Character::martial_arts_data</a>, <a class="el" href="item_8cpp_source.html#l05265">item::reach_range()</a>, <a class="el" href="string__id_8h_source.html#l00255">string_id&lt; T &gt;::str()</a>, and <a class="el" href="item_8h_source.html#l02162">item::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="npc_8cpp_source.html#l02192">npc::average_damage_dealt()</a>, <a class="el" href="melee_8cpp_source.html#l02362">unarmed_value()</a>, and <a class="el" href="melee_8cpp_source.html#l02318">weapon_value()</a>.</p>

</div>
</div>
<a id="a64daf871b45496787e445f932f4381d3" name="a64daf871b45496787e445f932f4381d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64daf871b45496787e445f932f4381d3">&#9670;&nbsp;</a></span>unarmed_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_ai::unarmed_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evaluate unarmed melee value. </p>

<p class="definition">Definition at line <a class="el" href="melee_8cpp_source.html#l02362">2362</a> of file <a class="el" href="melee_8cpp_source.html">melee.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span>{</div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span>    <span class="comment">// TODO: Martial arts</span></div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacenpc__ai.html#a15c5ded877137a648d04762228055b66">melee_value</a>( who, <a class="code hl_class" href="classitem.html">item</a>() );</div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span>}</div>
<div class="ttc" id="anamespacenpc__ai_html_a15c5ded877137a648d04762228055b66"><div class="ttname"><a href="namespacenpc__ai.html#a15c5ded877137a648d04762228055b66">npc_ai::melee_value</a></div><div class="ttdeci">double melee_value(const Character &amp;who, const item &amp;weap)</div><div class="ttdoc">Evaluate item as a melee weapon.</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l02337">melee.cpp:2337</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="melee_8cpp_source.html#l02337">melee_value()</a>.</p>

</div>
</div>
<a id="a6fa541a904a63a5b95b20ce9000254d8" name="a6fa541a904a63a5b95b20ce9000254d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fa541a904a63a5b95b20ce9000254d8">&#9670;&nbsp;</a></span>weapon_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_ai::weapon_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>weap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ammo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evaluate item as weapon (melee or gun) </p>

<p class="definition">Definition at line <a class="el" href="melee_8cpp_source.html#l02318">2318</a> of file <a class="el" href="melee_8cpp_source.html">melee.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span>{</div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> val_gun = <a class="code hl_function" href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">gun_value</a>( who, weap, ammo );</div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> val_melee = <a class="code hl_function" href="namespacenpc__ai.html#a15c5ded877137a648d04762228055b66">melee_value</a>( who, weap );</div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_enumvalue" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5aea74589f67c5fc9945d7dde9d16aecda3a">more</a> = std::max( val_gun, val_melee );</div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> less = std::min( val_gun, val_melee );</div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span> </div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span>    <span class="comment">// discourage wielding helmets, but not worn firearms</span></div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span>    <span class="keywordtype">int</span> armor_penalty = 1;</div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span>    <span class="keywordflow">if</span>( weap.<a class="code hl_function" href="classitem.html#a9aab8660fb40eedb8d2da95e797ecd32">is_armor</a>() &amp;&amp; !weap.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span>        armor_penalty = 0;</div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span>    }</div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span> </div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span>    <span class="comment">// A small bonus for guns you can also use to hit stuff with (bayonets etc.)</span></div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> my_val = ( <a class="code hl_enumvalue" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5aea74589f67c5fc9945d7dde9d16aecda3a">more</a> + ( less / 2.0 ) ) * armor_penalty;</div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span>    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s (%ld ammo) sum value: %.1f&quot;</span>, weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>(), ammo, my_val );</div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span>    <span class="keywordflow">return</span> my_val;</div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span>}</div>
<div class="ttc" id="aclassitem_html_a2912b2e15a4eec07a5070fffbbd152e8"><div class="ttname"><a href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">item::is_gun</a></div><div class="ttdeci">bool is_gun() const</div><div class="ttdoc">Can this item be used to perform a ranged attack?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06517">item.cpp:6517</a></div></div>
<div class="ttc" id="aclassitem_html_a9aab8660fb40eedb8d2da95e797ecd32"><div class="ttname"><a href="classitem.html#a9aab8660fb40eedb8d2da95e797ecd32">item::is_armor</a></div><div class="ttdeci">bool is_armor() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06704">item.cpp:6704</a></div></div>
<div class="ttc" id="anamespacedetail_1_1digits_html_aad69d2373aa047bdd9e81494bf3da5aea74589f67c5fc9945d7dde9d16aecda3a"><div class="ttname"><a href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5aea74589f67c5fc9945d7dde9d16aecda3a">detail::digits::more</a></div><div class="ttdeci">@ more</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__format-inl_8h_source.html#l01627">fmtlib_format-inl.h:1627</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="messages_8cpp_source.html#l00910">add_msg()</a>, <a class="el" href="itype_8cpp_source.html#l00088">itype::get_id()</a>, <a class="el" href="ranged_8cpp_source.html#l01970">gun_value()</a>, <a class="el" href="item_8cpp_source.html#l06704">item::is_armor()</a>, <a class="el" href="item_8cpp_source.html#l06517">item::is_gun()</a>, <a class="el" href="enums_8h_source.html#l00271">m_debug</a>, <a class="el" href="melee_8cpp_source.html#l02337">melee_value()</a>, <a class="el" href="fmtlib__format-inl_8h_source.html#l01627">detail::digits::more</a>, <a class="el" href="string__id_8h_source.html#l00255">string_id&lt; T &gt;::str()</a>, and <a class="el" href="item_8h_source.html#l02162">item::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="bionics_8cpp_source.html#l00499">npc::check_or_use_weapon_cbm()</a>, <a class="el" href="npctalk_8cpp_source.html#l03374">give_item_to()</a>, <a class="el" href="npc_8cpp_source.html#l01757">npc::value()</a>, and <a class="el" href="npcmove_8cpp_source.html#l03425">npc::wield_better_weapon()</a>.</p>

</div>
</div>
<a id="a9faf14aeb5366ab3ab7efb40e267907d" name="a9faf14aeb5366ab3ab7efb40e267907d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9faf14aeb5366ab3ab7efb40e267907d">&#9670;&nbsp;</a></span>wielded_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_ai::wielded_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>ideal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evaluate wielded weapon. </p>

<p class="definition">Definition at line <a class="el" href="melee_8cpp_source.html#l02291">2291</a> of file <a class="el" href="melee_8cpp_source.html">melee.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span>{</div>
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"> 2293</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> cached = ideal ? *who.<a class="code hl_function" href="classCharacter.html#af27efb6a73d59f0fb275a23a44afb46b">get_npc_ai_info_cache</a>( <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da6c1d5de20741d1572a1638942c179e99">npc_ai_info::ideal_weapon_value</a> ) :</div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span>                          *who.<a class="code hl_function" href="classCharacter.html#af27efb6a73d59f0fb275a23a44afb46b">get_npc_ai_info_cache</a>( <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da5795b0d5637a6bb0691323c64d3eb6bd">npc_ai_info::weapon_value</a> );</div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span>    <span class="keywordflow">if</span>( cached &gt;= 0.0 ) {</div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span>        <span class="keywordflow">if</span>( ideal ) {</div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s ideal sum value: %.1f&quot;</span>, who.<a class="code hl_function" href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">primary_weapon</a>().<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>(), cached );</div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s cached sum value: %.1f&quot;</span>, who.<a class="code hl_function" href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">primary_weapon</a>().<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>(), cached );</div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span>        }</div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span>        <span class="keywordflow">return</span> cached;</div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span>    }</div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span>    <span class="keywordtype">int</span> ammo_count = ideal ? who.<a class="code hl_function" href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">primary_weapon</a>().<a class="code hl_function" href="classitem.html#a5d89f04a2a08245ec865db0865e8a6c1">ammo_capacity</a>() :</div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span>                     <a class="code hl_function" href="namespacecharacter__funcs.html#a97bfa1444b6ed6f142910821e84fe313">character_funcs::ammo_count_for</a>( who, who.<a class="code hl_function" href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">primary_weapon</a>() );</div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span>    <a class="code hl_class" href="classitem.html">item</a> ideal_weapon = who.<a class="code hl_function" href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">primary_weapon</a>();</div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span>    <span class="keywordflow">if</span>( !ideal_weapon.<a class="code hl_function" href="classitem.html#ab07d96e30c441a84435972df842f4c77">ammo_default</a>().<a class="code hl_function" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ) {</div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span>        ideal_weapon.<a class="code hl_function" href="classitem.html#a6a3f16444c412bce4b75a7d600d6a3fe">ammo_set</a>( ideal_weapon.<a class="code hl_function" href="classitem.html#ab07d96e30c441a84435972df842f4c77">ammo_default</a>(), -1 );</div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span>    }</div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span>    <span class="keywordtype">double</span> weap_val = <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da5795b0d5637a6bb0691323c64d3eb6bd">weapon_value</a>( who, ideal ? ideal_weapon : who.<a class="code hl_function" href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">primary_weapon</a>(), ammo_count );</div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span>    <span class="keywordflow">if</span>( ideal ) {</div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span>        who.<a class="code hl_function" href="classCharacter.html#afcedb6ffb07cd9b269a7bbd63dc0f418">set_npc_ai_info_cache</a>( <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da6c1d5de20741d1572a1638942c179e99">npc_ai_info::ideal_weapon_value</a>, weap_val );</div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span>        who.<a class="code hl_function" href="classCharacter.html#afcedb6ffb07cd9b269a7bbd63dc0f418">set_npc_ai_info_cache</a>( <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da5795b0d5637a6bb0691323c64d3eb6bd">npc_ai_info::weapon_value</a>, weap_val );</div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span>    }</div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span>    <span class="keywordflow">return</span> weap_val;</div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span>}</div>
<div class="ttc" id="acharacter_8h_html_addab86bfe6fd0bf8c22ec43df3ec051da5795b0d5637a6bb0691323c64d3eb6bd"><div class="ttname"><a href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da5795b0d5637a6bb0691323c64d3eb6bd">weapon_value</a></div><div class="ttdeci">@ weapon_value</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00101">character.h:101</a></div></div>
<div class="ttc" id="acharacter_8h_html_addab86bfe6fd0bf8c22ec43df3ec051da6c1d5de20741d1572a1638942c179e99"><div class="ttname"><a href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da6c1d5de20741d1572a1638942c179e99">ideal_weapon_value</a></div><div class="ttdeci">@ ideal_weapon_value</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00102">character.h:102</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9cec37becf60e594b4978cb8f8c5278b"><div class="ttname"><a href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">Character::primary_weapon</a></div><div class="ttdeci">item &amp; primary_weapon()</div><div class="ttdoc">Legacy code hack, don't use.</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l00154">melee.cpp:154</a></div></div>
<div class="ttc" id="aclassCharacter_html_af27efb6a73d59f0fb275a23a44afb46b"><div class="ttname"><a href="classCharacter.html#af27efb6a73d59f0fb275a23a44afb46b">Character::get_npc_ai_info_cache</a></div><div class="ttdeci">std::optional&lt; double &gt; get_npc_ai_info_cache(npc_ai_info key) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10613">character.cpp:10613</a></div></div>
<div class="ttc" id="aclassCharacter_html_afcedb6ffb07cd9b269a7bbd63dc0f418"><div class="ttname"><a href="classCharacter.html#afcedb6ffb07cd9b269a7bbd63dc0f418">Character::set_npc_ai_info_cache</a></div><div class="ttdeci">void set_npc_ai_info_cache(npc_ai_info key, double val) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10608">character.cpp:10608</a></div></div>
<div class="ttc" id="anamespacecharacter__funcs_html_a97bfa1444b6ed6f142910821e84fe313"><div class="ttname"><a href="namespacecharacter__funcs.html#a97bfa1444b6ed6f142910821e84fe313">character_funcs::ammo_count_for</a></div><div class="ttdeci">int ammo_count_for(const Character &amp;who, const item &amp;gun)</div><div class="ttdoc">Counts ammo and UPS charges (lower of) for a given gun on the character.</div><div class="ttdef"><b>Definition:</b> <a href="character__functions_8cpp_source.html#l01180">character_functions.cpp:1180</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="messages_8cpp_source.html#l00910">add_msg()</a>, <a class="el" href="item_8cpp_source.html#l07414">item::ammo_capacity()</a>, <a class="el" href="character__functions_8cpp_source.html#l01180">character_funcs::ammo_count_for()</a>, <a class="el" href="item_8cpp_source.html#l07601">item::ammo_default()</a>, <a class="el" href="item_8cpp_source.html#l00590">item::ammo_set()</a>, <a class="el" href="itype_8cpp_source.html#l00088">itype::get_id()</a>, <a class="el" href="character_8cpp_source.html#l10613">Character::get_npc_ai_info_cache()</a>, <a class="el" href="character_8h_source.html#l00102">ideal_weapon_value</a>, <a class="el" href="string__id_8h_source.html#l00317">string_id&lt; T &gt;::is_null()</a>, <a class="el" href="enums_8h_source.html#l00271">m_debug</a>, <a class="el" href="melee_8cpp_source.html#l00154">Character::primary_weapon()</a>, <a class="el" href="character_8cpp_source.html#l10608">Character::set_npc_ai_info_cache()</a>, <a class="el" href="string__id_8h_source.html#l00255">string_id&lt; T &gt;::str()</a>, <a class="el" href="item_8h_source.html#l02162">item::type</a>, and <a class="el" href="character_8h_source.html#l00101">weapon_value</a>.</p>

<p class="reference">Referenced by <a class="el" href="npcmove_8cpp_source.html#l00629">npc::character_danger()</a>, <a class="el" href="bionics_8cpp_source.html#l00499">npc::check_or_use_weapon_cbm()</a>, <a class="el" href="npc_8cpp_source.html#l01497">npc::decide_needs()</a>, <a class="el" href="npc_8cpp_source.html#l01224">npc::form_opinion()</a>, <a class="el" href="avatar__action_8cpp_source.html#l00576">rate_critter()</a>, <a class="el" href="npcmove_8cpp_source.html#l00651">npc::regen_ai_cache()</a>, <a class="el" href="npc_8cpp_source.html#l01757">npc::value()</a>, and <a class="el" href="npcmove_8cpp_source.html#l03425">npc::wield_better_weapon()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacenpc__ai.html">npc_ai</a></li>
    <li class="footer">Generated on Sat May 20 2023 04:40:29 for Cataclysm BN by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
